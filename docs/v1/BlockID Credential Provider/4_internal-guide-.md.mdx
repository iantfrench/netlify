---
slug: /v1/internal-guide-blockid-credential-provider
id: Z2a1eca53-c7d1-4dcd-9b6d-fa2172332efb
---
# Internal Guide - BlockID Credential Provider
This is an internal guide created with a detailed explanation of each process involved within the BlockID Credential Provider (CP) structure. It also covers a few FAQs related to the CP functionalities.

In several enterprises, the user gets the smart card to log in to their Windows workstation. It is a hardware USB device, a physical card used to authenticate users in their Windows workstation. When a user is trying to login to its Windows workstation using this USB smart card device, the user certificate is generated by the certificate authority and SCEP using the AD on the server. The administrator burns that user certificate onto the USB device and sends that certificate along with the user’s identifier private key to the Windows workstation. Windows workstation queries the AD and validates the certificate and allows the user to login to it upon successful authentication.

## Logical Workflow behind Enrolling Persona
:::(Warning) (Info:)
To get the detailed steps on enrolling personas within the BlockID Workforce mobile application, refer to the [Install and Configure BlockID Workforce mobile app](https://1kosmos.document360.io/docs/en/login-using-blockid-workforce-mobile-application#a-nameinstallbw-datatomarkpassainstall-and-configure-blockid-workforce-mobile-app){target="_blank"} section from the **Login using BlockID Workforce Mobile Application** guide.
:::

1. Registration on the mobile device.
2. Enroll Personas:
    * Add the tenant URL (of BlockID Admin Console). For Example, `http://demo.onekosmos.com`.
    * User registration using your UserID and Password available on the AD server
3. In the BlockID Admin Console:
    * It receives your UserID and Password, queries the AD to check the validity of those login credentials.
    * After validating the login credentials, the console runs the SCEP Enrollment Challenge URL (from the SCEP configurations) that points to the NDES web service (of an enterprise) to generate a challenge password. 
    * The challenge password will be forwarded to the SCEP server URL at the AD server. The .dll service mentioned in the  SCEP server URL runs and generates the certificate for the user using the challenge password. This generated certificate will be passed on to the BlockID Admin Console.
    * The certificate is divided into two parts - **Public key** and **Signature token**. The public key is saved on the **IPFS** on the BlockID Admin Console. The hash value of the location where the public key is stored will be sent to the mobile device along with the signature token to enroll the user in the BlockID Workforce mobile app.

## QR Code Scanning: 
After configurations, when a user scans QR code using the BlockID Workforce mobile application:

The QR code consists of JSON payload:

1.**Auth type**: Fingerprint, Pin, Face. The default type is a fingerprint, get received by the workforce mobile app which tells what auth mechanism should be used
2. **Scopes**: Send `windows` as a value: mobile device recognizes that the data (hash of the location of IPFS and signature token) need to be sent from the mobile device to the Windows login.
3. **ECDSA** public key of CP
4. URL to which the mobile app is trying to connect: `<<tenant>.onekosmos.com:/80/api/ws/<community>/did-login/<session-id>>`.
    * The **session-id** is a Globally Unique (GU) id and every time the QR code is generated for a new connection, the new session-id is generated for each QR code.

In the BlockID Workforce mobile app, this payload data is encrypted using the private key of the mobile and public key of the CP and the app sends these details (along with the public key) to the BlockID Admin Console. After CP establishes a WebSocket connection with the console. The console receives the encrypted payload from the mobile app and forwards it to the CP. The CP then receives encrypted payload data from the console and decrypts it using its own private key and the public key of the mobile device. The CP initiates a GET request on the IPFS API, it receives the certificate and will pass that certificate to Windows. Windows receives the certificate and signature token, validates it with their AD, and allows you to login upon successful authentication.

## Logging in using Push notification:
The CP checks whether any user is in the same session, it displays tile for that particular user for login. When you click on that user, the CP sends push notification on the mobile device (which is associated with that user’s UserID) with the message heading as "**BlockID authentication request Login Alert**".

In the case of Push notification, the CP sends the same payload to the mobile app through the admin console. Before the Payload data is sent, the CP first hits a REST URL which fetches the public key of the console. After fetching the public key, the CP encrypts the payload using the ECDSA encryption using the private key of CP and the public key of the Console. This encrypted payload data along with the CP’s public key is sent to the console on a different REST URL which is the push notification URL. After receiving the encrypted payload, the console decrypts it using the CP’s public key and its own private key. Using the received UserID, the console queries the smart contract to access the blockchain and get the user details like `pushid`, `deviceid` and the `devicetype`. Upon receiving the user’s push and device details it sends the push notification to the associated mobile device. The mobile device receives the push notification with the CP’s payload. The **Base64** encrypted payload will be received by the mobile device of the user.

When some other user is already logged in using Windows login and locked the machine:
1. Click the **Switch User** option and click on your **CP login** option.  The push notification will get sent to you on your CP login option. The push notification will get sent to you on your mobile device with the message heading as "**BlockID authentication request Login Alert**".
2. Click on the push notification message.
3. Click on the** Login with Fingerprint** (option added under ***BlockID Configuration > BlockID Configuration Parameters > Auth Type***) option.
4. Provide your biometric authentication details. The app will send the requested data to the **BlockID Credential Provider**. 
This allows users to **login** to their workstation by scanning a QR code and **unlock** their workstation via a push notification.

## FAQs: 
#### Why do we set the state as ‘Running’ just after the CP installation when there are no configurations added in the CP? As when you are installing CP on a Windows machine using RDP.
The default state of the CP after installation is “Running” as it is running as a service. The RDP is not recommended, when you are connecting to a Windows machine for the CP installation. You have to use the client that does not use the RDP protocol because the RDP protocol uses network-layer authentication. In the RDP client, you enter a Username and password before connecting, so RDP client expects the credentials from the network layer to be passed on. In VNC, we don’t use and login credentials. Thus, we recommend using a VNC client instead of RDP to connect to a Windows machine when installing CP.

#### How the CP configurations are done on multiple individual machines?
The CP configurations will be pushed to 100 workstations via a Group Policy Object (GPO) - a collection of Group Policy settings on AD. Only Administrators can perform the CP configurations for all the Windows workstations and not the user of that Windows machine.

#### If the Windows machine is not connected to the internet, then the offline user authentication from CP will work or not?
No, it will not work. As currently, we do not support offline user authentication via CP. This process is under progress. In this case, the user can use their normal Windows login option.

#### Can we auto-reset the user’s password using CP based on the organization’s password reset policy?
You can reset the password within the BlockID Workforce mobile application by adding a new password.
